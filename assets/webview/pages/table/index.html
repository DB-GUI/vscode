<div id="vue-app">
  <header>
    <ppz-nav></ppz-nav>
    <div class="operations">
      <div class="btns">
        <icon-btn iid="light" @click="refresh" title="{{l10n.refresh}}"></icon-btn>
        <icon-btn iid="search" @click="$refs.searchDialog.showModal()" title="{{l10n.search}}"></icon-btn>
        <dialog class="search" ref="searchDialog">
          <div class="modal"></div>
          <div class="title">{{l10n.dataSearch}}</div>
          <div class="body">
            <search-item
              v-for="(item, index) in selectParams.search"
              :fields="fields"
              v-model:field="item.field"
              v-model:operator="item.operator"
              v-model:value="item.value"
              @destroy="selectParams.search.splice(index, 1)"
              ></search-item>
            <icon-btn iid="add" class="round" @click="addSearch"></icon-btn>
          </div>
          <div class="btns">
            <button @click="search">{{l10n.search}}</button>
            <button @click="emptySearch">{{l10n.clear}}</button>
            <button @click="$refs.searchDialog.close()">{{l10n.close}}</button>
          </div>
        </dialog>
        <icon-btn iid="filter" @click="$refs.fieldSelector.showModal()" title="{{l10n.fieldSelect}}"></icon-btn>
        <dialog class="field" ref="fieldSelector">
          <div class="modal"></div>
          <div class="title">{{l10n.fieldSelect}}</div>
          <div class="body">
            <ppz-checkbox v-for="f in fields" v-model="f.show" :label="f.name"></ppz-checkbox>
          </div>
          <div class="btns">
            <button @click="select1()">{{l10n.selectAll}}</button>
            <button @click="select_1">{{l10n.invertSelect}}</button>
            <button @click="select0">{{l10n.noSelect}}</button>
            <button @click="$refs.fieldSelector.close()">{{l10n.close}}</button>
          </div>
        </dialog>
        <icon-btn iid="add" @click="newRecord()" title="{{l10n.add}}"></icon-btn>
        <icon-btn iid="copy" @click="newRecord(true)" title="{{l10n.copy}}"
          :disabled="!pneOptions || pneOptions.focus.y === undefined"></icon-btn>
        <icon-btn iid="save" @click="save" title="{{l10n.save}}"
          :disabled="!hasPK || !isEditing"></icon-btn>
        <icon-btn iid="undo" @click="undo" title="{{l10n.allUndo}}"
          :disabled="!hasPK || !isEditing"></icon-btn>
        <icon-btn iid="delete" @click="drop" title="{{l10n.delete}}"
          :disabled="!hasPK || pneOptions.focus.y === undefined"></icon-btn>
        <icon-btn iid="sql" @click="checkSQL" title="{{l10n.checkCurrentSql}}"></icon-btn>
        <dialog ref="sqlViewer" class="sql">
          <div class="modal"></div>
          <div class="title">{{l10n.checkSql}}</div>
          <div class="body">
            <p>{{sql.clause}}</p>
            <radio-group
              v-model="sql.noPagination"
              @update:model-value="checkSQL"
              :list="list"
              ></radio-group>
          </div>
          <div class="btns">
            <button @click="openFileWithSQL">{{l10n.openFileWithSQL}}</button>
            <button @click="writeClipboard">{{l10n.writeClipboard}}</button>
            <button @click="openTerminalWithSQL">{{l10n.openTerminalWithSQL}}</button>
            <button @click="$refs.sqlViewer.close()">{{l10n.close}}</button>
          </div>
        </dialog>
        <icon-btn iid="terminal" @click="terminal" title="{{l10n.openTerminal}}"></icon-btn>
      </div>
      <ppz-pagination :count="selectParams.page.count"
        :l10n="this.l10n"
        @click.capture="beforePage"
        v-model:index="selectParams.page.index"
        v-model:size="selectParams.page.size"
        @change="putData"
        ></ppz-pagination>
    </div>
  </header>
  <div class="table-wrapper">
    <ppz-pne :fields="fields" :records="records" :options="pneOptions"
      :editable="hasPK"
      @sort="putData"
      ></ppz-pne>
  </div>
</div>